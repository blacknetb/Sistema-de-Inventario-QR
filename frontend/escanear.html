<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esc√°ner QR - Sistema de Inventario QR</title>
    <link rel="stylesheet" href="./css/escanear.css">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/forms.css">
    <link rel="stylesheet" href="./css/modal.css">
    <link rel="stylesheet" href="./css/responsive.css">
</head>
<body>
    <div id="sidebar-container"></div>
    
    <div class="main-content">
        <div id="navbar-container"></div>
        
        <main class="content">
            <div class="page-header">
                <h1>Esc√°ner QR</h1>
                <p>Escanea c√≥digos QR de productos para gestionar inventario</p>
            </div>
            
            <div class="scanner-container">
                <div class="scanner-card">
                    <div class="scanner-header">
                        <h3>Esc√°ner de C√≥digo QR</h3>
                        <div class="scanner-controls">
                            <button id="startScannerBtn" class="btn btn-primary">
                                <span>Iniciar Esc√°ner</span>
                            </button>
                            <button id="stopScannerBtn" class="btn btn-secondary" disabled>
                                <span>Detener Esc√°ner</span>
                            </button>
                            <button id="toggleCameraBtn" class="btn btn-secondary" disabled>
                                <span>Cambiar C√°mara</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="scanner-body">
                        <!-- Vista del esc√°ner -->
                        <div id="scannerView" class="scanner-view">
                            <div id="reader"></div>
                            <div class="scanner-overlay">
                                <div class="scanner-frame"></div>
                                <div class="scanner-line"></div>
                                <p class="scanner-instruction">Coloca el c√≥digo QR dentro del marco</p>
                            </div>
                        </div>
                        
                        <!-- Resultado del escaneo -->
                        <div id="scanResult" class="scan-result" style="display: none;">
                            <div class="result-header">
                                <h3>Producto Escaneado</h3>
                                <button id="newScanBtn" class="btn btn-secondary">
                                    <span>Nuevo Escaneo</span>
                                </button>
                            </div>
                            
                            <div id="productInfo" class="product-info">
                                <!-- La informaci√≥n del producto se cargar√° aqu√≠ -->
                                <div class="loading">Cargando informaci√≥n del producto...</div>
                            </div>
                            
                            <div class="quick-actions">
                                <button id="viewProductBtn" class="btn btn-primary">
                                    <span>Ver Producto</span>
                                </button>
                                <button id="registerMovementBtn" class="btn btn-secondary">
                                    <span>Registrar Movimiento</span>
                                </button>
                                <button id="generateLabelBtn" class="btn btn-secondary">
                                    <span>Generar Etiqueta</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Mensaje de ayuda -->
                        <div id="scannerHelp" class="scanner-help">
                            <h4>¬øC√≥mo usar el esc√°ner?</h4>
                            <ol>
                                <li>Haz clic en "Iniciar Esc√°ner" para activar la c√°mara</li>
                                <li>Apunta la c√°mara hacia el c√≥digo QR del producto</li>
                                <li>Mant√©n el c√≥digo dentro del marco de escaneo</li>
                                <li>El sistema detectar√° autom√°ticamente el producto</li>
                            </ol>
                            
                            <div class="scanner-tips">
                                <p><strong>Consejos:</strong></p>
                                <ul>
                                    <li>Aseg√∫rate de tener buena iluminaci√≥n</li>
                                    <li>Mant√©n estable el dispositivo</li>
                                    <li>El c√≥digo QR debe estar limpio y legible</li>
                                    <li>Prueba diferentes √°ngulos si hay problemas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Historial de escaneos recientes -->
                <div class="scanner-card">
                    <div class="card-header">
                        <h3>Escaneos Recientes</h3>
                        <button id="clearHistoryBtn" class="btn btn-sm btn-secondary">
                            <span>Limpiar Historial</span>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="scanHistory">
                            <div class="scan-history-item">
                                <div class="scan-time">Hace 5 minutos</div>
                                <div class="scan-product">Producto: Monitor 24"</div>
                                <div class="scan-result">‚úÖ Escaneo exitoso</div>
                            </div>
                            <div class="scan-history-item">
                                <div class="scan-time">Hace 15 minutos</div>
                                <div class="scan-product">Producto: Teclado Mec√°nico</div>
                                <div class="scan-result">‚úÖ Escaneo exitoso</div>
                            </div>
                        </div>
                        <div id="emptyHistory" class="empty-history">
                            <p>No hay escaneos recientes</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Acciones r√°pidas -->
            <div class="quick-scanner-actions">
                <h3>Acciones R√°pidas</h3>
                <div class="actions-grid">
                    <button id="scanAndAddBtn" class="action-btn">
                        <div class="action-icon">
                            <span>‚ûï</span>
                        </div>
                        <span>Esc. y Agregar</span>
                    </button>
                    
                    <button id="scanAndRemoveBtn" class="action-btn">
                        <div class="action-icon">
                            <span>‚ûñ</span>
                        </div>
                        <span>Esc. y Retirar</span>
                    </button>
                    
                    <button id="scanAndTransferBtn" class="action-btn">
                        <div class="action-icon">
                            <span>üîÑ</span>
                        </div>
                        <span>Esc. y Transferir</span>
                    </button>
                    
                    <button id="scanMultipleBtn" class="action-btn">
                        <div class="action-icon">
                            <span>üìã</span>
                        </div>
                        <span>Esc. M√∫ltiple</span>
                    </button>
                    
                    <button id="scanInventoryBtn" class="action-btn">
                        <div class="action-icon">
                            <span>üìä</span>
                        </div>
                        <span>Inventario F√≠sico</span>
                    </button>
                    
                    <button id="manualEntryBtn" class="action-btn">
                        <div class="action-icon">
                            <span>‚å®Ô∏è</span>
                        </div>
                        <span>Entrada Manual</span>
                    </button>
                </div>
            </div>
        </main>
        
        <div id="footer-container"></div>
    </div>
    
    <!-- Modal para entrada manual -->
    <div id="manualEntryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Entrada Manual de C√≥digo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="manualEntryForm">
                    <div class="form-group">
                        <label for="manualCode">C√≥digo del Producto</label>
                        <input type="text" id="manualCode" name="code" required class="form-control" placeholder="Ingresa el c√≥digo del producto">
                    </div>
                    
                    <div class="form-group">
                        <label for="codeType">Tipo de C√≥digo</label>
                        <select id="codeType" name="code_type" class="form-control">
                            <option value="qr_code">C√≥digo QR</option>
                            <option value="barcode">C√≥digo de Barras</option>
                            <option value="product_code">C√≥digo de Producto</option>
                            <option value="sku">SKU</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Buscar Producto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal para inventario f√≠sico -->
    <div id="inventoryModal" class="modal modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Inventario F√≠sico</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="inventory-instructions">
                    <h4>Instrucciones:</h4>
                    <p>1. Escanea cada producto en la ubicaci√≥n actual</p>
                    <p>2. El sistema registrar√° autom√°ticamente la cantidad</p>
                    <p>3. Al finalizar, compara con el inventario te√≥rico</p>
                </div>
                
                <div class="inventory-progress">
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                    <p class="progress-text">Escaneados: <span id="scannedCount">0</span> productos</p>
                </div>
                
                <div class="inventory-items">
                    <h4>Productos Escaneados:</h4>
                    <div id="inventoryList" class="inventory-list">
                        <!-- Los productos escaneados aparecer√°n aqu√≠ -->
                        <p class="text-muted">A√∫n no se han escaneado productos</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="finishInventoryBtn" class="btn btn-primary">Finalizar Inventario</button>
                <button id="cancelInventoryBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
    
    <div id="notificationContainer" class="notification-container"></div>
    
    <!-- Scripts -->
    <script src="./libs/html5-qrcode.min.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/utils.js"></script>
    <script src="./js/auth.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/scanner.js"></script>
    <script src="./js/notifications.js"></script>
</body>
</html>